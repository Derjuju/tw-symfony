{% extends 'AppBundle::layout.html.twig' %}

{% block title %}Troc {% if trocArchive %}terminé{% else %}en cours{% endif %} - {{ parent() }}{% endblock %}

{% block bodyclass %}troc-message {% if trocArchive %}troc-archive{% else %}troc-en-cours{% endif %}{% endblock %}

{% block header %}
    {% set withoutSearchSelector = true %}
    {% if trocArchive %}
        {% set titreH1 = "Troc terminé" %}
    {% else %}
        {% set titreH1 = "Troc en cours" %}
    {% endif %}
    
    {{ parent() }}
{% endblock %}

{% form_theme formMessage with ['AppBundle::form_theme.html.twig', _self] %}

{% block content %}
    {{ parent() }}   
    <section class="message-wrapper container">
	<nav class="message-menu">
		<a href="{{path('front_messagerie')}}" class="{% if not trocArchive %}active{% endif %}">Trocs en cours</a>
		<a href="{{path('front_messagerie_archives')}}" class="{% if trocArchive %}active{% endif %}">Anciens trocs</a>
	</nav>
	<section class="message-container">
		<div class="top">
                    <a href="{% if trocArchive %}{{path('front_messagerie_archives')}}{% else %}{{path('front_messagerie')}}{% endif %}" class="btn-default" style="width:100px;"><i class="icon-arrow-left"></i> Retour</a>                    
                        {% include 'AppBundle:Messages:_blocMessage.html.twig' with {'user' : user, 'message' : troc, 'clicable' : false} %}			                    
		</div>
		<section class="message-zone" role="main">
                        {% for section in troc.trocSections %}
                            {% if not loop.first %}
                                <article class="the-message-container">
                                {% if section.message != null %}
                                    {% include 'AppBundle:Messages:_blocSectionMessage.html.twig' with {'user' : user, 'section' : section} %}			                    
                                {% endif %}
                                {% if section.contenu != null %}
                                    {% include 'AppBundle:Messages:_blocSectionContenu.html.twig' with {'user' : user, 'section' : section} %}			                    
                                {% endif %}
                                {% if section.rdv != null %}
                                    {% include 'AppBundle:Messages:_blocSectionRDV.html.twig' with {'user' : user, 'section' : section} %}			                    
                                {% endif %}
                                </article>
                            {% endif %}
                        {% endfor %}
                        <div class="troc-actions">
                            <div class="choix-actions">
                                <button id="bt-action-ecrire" class="btn-default"> Ecrire un message</button> <button id="bt-action-rdv" class="btn-default"> Donner rendez-vous</button> <form id="FormSelectionChoix" action="{{path('front_troc_modifier', {'idTroc':troc.id})}}" method="POST"><button id="bt-action-changer" class="btn-default"> Modifier le troc</button></form>
                            </div>
                            <div class="panel-actions">
                                <div class="panel-action-ecrire hidden">
                                    {{ form_start(formMessage, {'attr': {'class': 'form-inline', 'id': 'FormAddMessage'} }) }}
                                        <div class="data-commentaire">
                                            {{ form_widget(formMessage.message, {'label': false,'class': '', 'attr': {'class': ''} }) }}
                                        </div>
                                        <button id="AjouterMessage" class="submit-btn btn-default">Valider le message</button>                                                                        
                                    {{ form_end(formMessage) }}
                                </div>
                                <div class="panel-action-rdv hidden">
                                    rdv
                                </div>
                            </div>
                        </div>
		</section>
                
        </section>
    </section>
{% endblock %}


{% block bottomJavascripts %}

    {{ parent() }}
    
    <script type="text/javascript">
        $(document).ready(function () {                        
            $('#bt-action-ecrire').on('click', function(){
                $('.panel-action-ecrire').removeClass('hidden');
                $('.panel-action-rdv').addClass('hidden');                
            });                        
            $('#bt-action-rdv').on('click', function(){
                $('.panel-action-ecrire').addClass('hidden');   
                $('.panel-action-rdv').removeClass('hidden');               
            });  
            
        });
    </script>
    
{% endblock %}